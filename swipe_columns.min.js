/*
 * @fileOverview SwipeColumns - jQuery Plugin
 * @version 1.0.1
 *
 * @author Peter Schmalfeldt http://www.github.com/manifestinteractive
 * @see https://github.com/manifestinteractive/swipe-columns-jquery-plugin
 * @requires https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
 * @requires http://benalman.com/projects/javascript-debug-console-log ( for Debugging )
 *
 * Copyright (c) Peter Schmalfeldt
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */

;(function($,window,document,undefined){var plugin_name="SwipeColumns",debug=typeof window.debug!=="undefined"?window.debug:{log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}},element=null,options={},column_width=0,column_height=0,current_page=0,current_percent=0,snap_threshold=0.25,page_count=0,defaults={animation_speed:300,debug_level:0,hide_adress_bar:false,use_keyboard_navigation:false,generate_page_numbers:false,page_number_format:"Page %%NUMBER%% of %%TOTAL%%",
column_padding:0};function Plugin(element,options){this._defaults=defaults;this._name=plugin_name;this.element=element;this.options=$.extend({},defaults,options);this.init()}function keyboard_handler(e){switch(e.keyCode){case 37:case 33:this.previous();break;case 39:case 34:this.next();break;case 38:case 36:this.home();break;case 40:case 35:this.go_to_page(page_count);break}}function generate_page_numbers(){var position=null;var i=0;$(".page_number").remove();$(".page_numbers",element).html("");for(i=
0;i<page_count;i++){var html='<div class="page_number" id="page_number_'+(i+1)+'">'+options.page_number_format+"</div>";html=html.replace("%%NUMBER%%",i+1);html=html.replace("%%TOTAL%%",page_count);$(".page_numbers",element).append(html);if(position===null)position=$("#page_number_1",element).position();$("#page_number_"+(i+1),element).css({"left":Math.ceil(position.left)+Math.ceil(column_width*i)+"px"})}}function swipe_status(event,phase,direction,distance){if(phase=="move"&&(direction=="left"||
direction=="right"))if(direction=="left")animate(column_width*current_page+distance,0);else{if(direction=="right")animate(column_width*current_page-distance,0)}else if(phase=="cancel")animate(column_width*current_page,options.animation_speed);else if(phase=="end"&&distance>Math.ceil(column_width*snap_threshold))if(direction=="right")Plugin.prototype.previous();else{if(direction=="left")Plugin.prototype.next()}else if(phase=="end"&&distance<=Math.ceil(column_width*snap_threshold))animate(column_width*
current_page,options.animation_speed);if(direction)$("body").trigger("sc_swipe_status.swipe_columns",[{"phase":phase,"direction":direction,"distance":distance}])}function animate(distance,duration){var value=(distance<0?"":"-")+Math.abs(distance).toString();$(".columns",element).css({"-webkit-transition-duration":(duration/1E3).toFixed(1)+"s","-webkit-transform":"translate3d("+value+"px,0,0)","-moz-transition-duration":(duration/1E3).toFixed(1)+"s","-moz-transform":"translate3d("+value+"px,0,0)",
"-o-transition-duration":(duration/1E3).toFixed(1)+"s","-o-transform":"translate3d("+value+"px,0,0)","transition-duration":(duration/1E3).toFixed(1)+"s","transform":"translate3d("+value+"px,0,0)"});if(distance>0)$("body").trigger("sc_animate.swipe_columns",[{"distance":distance,"duration":duration}])}function hide_address_bar(){var win=window;var doc=win.document;if(!location.hash&&win.addEventListener){win.scrollTo(0,1);var scrollTop=1,getScrollTop=function(){return win.pageYOffset||doc.compatMode===
"CSS1Compat"&&doc.documentElement.scrollTop||doc.body.scrollTop||0},bodycheck=setInterval(function(){if(doc.body){clearInterval(bodycheck);scrollTop=getScrollTop();win.scrollTo(0,scrollTop===1?0:1)}},15);win.addEventListener("load",function(){setTimeout(function(){if(getScrollTop()<20)win.scrollTo(0,scrollTop===1?0:1)},15)},false);win.addEventListener("orientationchange",function(){setTimeout(function(){if(getScrollTop()<20)win.scrollTo(0,scrollTop===1?0:1)},15)},false)}}Plugin.prototype={init:function(){options=
this.options;element=this.element;if(typeof window.debug!=="undefined")debug.setLevel(options.debug_level);debug.log("init()");Plugin.prototype.update_layout();if(options.hide_adress_bar)hide_address_bar();$("body").trigger("sc_init.swipe_columns",[{"options":options,"element":element}])},update_layout:function(updated){debug.log("update_layout()");$(".columns",element).css({"width":"auto"});$(element).css({"width":"100%","height":"100%","overflow":"hidden","position":"absolute","-webkit-overflow-scrolling":"touch",
"-moz-overflow-scrolling":"touch","-o-overflow-scrolling":"touch","overflow-scrolling":"touch","-webkit-transform":"translate3d(0,0,0)","-moz-transform":"translate3d(0,0,0)","-0-transform":"translate3d(0,0,0)","transform":"translate3d(0,0,0)","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","-o-box-sizing":"border-box","box-sizing":"border-box"});$(".columns",element).css({"overflow":"hidden"});column_width=Math.ceil($(element).width());column_height=Math.ceil($(element).height()-
options.column_padding*2);var css_column_width=Math.ceil(column_width-options.column_padding);var css_column_gap=Math.ceil(options.column_padding*2);$(".columns",element).css({"height":column_height+"px","z-index":100,"padding":options.column_padding+"px","margin":"0","padding-right":"0","position":"relative","-webkit-transition-property":"-webkit-transform","-webkit-transition-duration":"0.5s","-webkit-transition-timing-function":"ease-out","-webkit-transform":"translate3d(0,0,0)","-moz-transition-property":"-moz-transform",
"-moz-transition-duration":"0.5s","-moz-transition-timing-function":"ease-out","-moz-transform":"translate3d(0,0,0)","-o-transition-property":"-o-transform","-o-transition-duration":"0.5s","-o-transition-timing-function":"ease-out","-o-transform":"translate3d(0,0,0)","transition-property":"transform","transition-duration":"0.5s","transition-timing-function":"ease-out","transform":"translate3d(0,0,0)","-webkit-column-count":"auto","-webkit-column-width":css_column_width+"px","-webkit-column-gap":css_column_gap+
"px","-webkit-column-rule":"none","-moz-column-count":"auto","-moz-column-width":css_column_width+"px","-moz-column-gap":css_column_gap+"px","-moz-column-rule":"none","-o-column-count":"auto","-o-column-width":css_column_width+"px","-o-column-gap":css_column_gap+"px","-o-column-rule":"none","column-count":"auto","column-width":css_column_width+"px","column-gap":css_column_gap+"px","column-rule":"none"});$("*",element).css({"-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","-o-box-sizing":"border-box",
"box-sizing":"border-box","max-width":css_column_width+"px"});var offset=updated?column_width:0;page_count=Math.ceil(($(".columns",element)[0].scrollWidth-offset)/column_width);$(".columns",element).css({"width":page_count*column_width+"px","overflow":"visible"});if(updated){var new_page=Math.floor(page_count*current_percent);Plugin.prototype.go_to_page(new_page)}Plugin.prototype.setup_swipe();$("body").trigger("sc_update_layout.swipe_columns",[{"updated":updated,"page_count":page_count,"column_width":column_width,
"column_height":column_height,"css_column_width":css_column_width,"css_column_gap":css_column_gap}])},setup_swipe:function(){debug.log("setup_swipe()");var swipeOptions={triggerOnTouchEnd:true,swipeStatus:swipe_status,allowPageScroll:"vertical",threshold:75,cancelThreshold:50};$(".columns",element).swipe("destroy");$(".columns",element).swipe(swipeOptions);if(options.generate_page_numbers)setTimeout(function(){generate_page_numbers()},100);if(options.use_keyboard_navigation)Plugin.prototype.keyboard_navigation();
$("body").trigger("sc_setup_swipe.swipe_columns",[swipeOptions])},keyboard_navigation:function(){debug.log("keyboard_navigation()");var that=this;$("body").off("keyup.swipe_columns");$("body").on("keyup.swipe_columns",function(e){keyboard_handler.call(that,e)})},previous:function(){current_page--;if(current_page<0){current_page=0;debug.log("On First Page")}debug.log("Go to Page "+(current_page+1)+" of "+page_count);animate(column_width*current_page,options.animation_speed);current_percent=(1+current_page)/
page_count;$("body").trigger("sc_previous.swipe_columns",[{"current_page":1+current_page,"current_percent":Math.round(current_percent*100),"page_count":page_count}]);$("body").trigger("sc_page_change.swipe_columns",[{"current_page":1+current_page,"current_percent":Math.round(current_percent*100),"page_count":page_count}])},next:function(){current_page++;if(current_page>page_count-1){current_page=page_count-1;debug.log("On Last Page")}debug.log("Go to Page "+(current_page+1)+" of "+page_count);animate(column_width*
current_page,options.animation_speed);current_percent=(1+current_page)/page_count;$("body").trigger("sc_next.swipe_columns",[{"current_page":1+current_page,"current_percent":Math.round(current_percent*100),"page_count":page_count}]);$("body").trigger("sc_page_change.swipe_columns",[{"current_page":1+current_page,"current_percent":Math.round(current_percent*100),"page_count":page_count}])},go_to_page:function(page){page=page-1;current_page=Math.min(Math.max(parseInt(page,10),0),page_count-1);debug.log("Jumping to Page "+
(current_page+1)+" of "+page_count);animate(column_width*current_page,options.animation_speed);current_percent=(1+current_page)/page_count;$("body").trigger("sc_go_to_page.swipe_columns.swipe_columns",[{"current_page":1+current_page,"current_percent":Math.round(current_percent*100),"page_count":page_count}]);$("body").trigger("sc_page_change.swipe_columns.swipe_columns",[{"current_page":1+current_page,"current_percent":Math.round(current_percent*100),"page_count":page_count}])},home:function(){debug.log("Go to First Page");
current_page=0;animate(column_width*current_page,options.animation_speed);current_percent=(1+current_page)/page_count;$("body").trigger("sc_home.swipe_columns.swipe_columns",[{"current_page":1+current_page,"current_percent":Math.round(current_percent*100),"page_count":page_count}]);$("body").trigger("sc_page_change.swipe_columns.swipe_columns",[{"current_page":1+current_page,"current_percent":Math.round(current_percent*100),"page_count":page_count}])},current_page:function(){debug.log("Get Current Page");
return current_page}};$.fn[plugin_name]=function(options,args){return this.each(function(){if(!$.data(this,"plugin_"+plugin_name))$.data(this,"plugin_"+plugin_name,new Plugin(this,options));else if($.isFunction(Plugin.prototype[options]))$.data(this,"plugin_"+plugin_name)[options](args);window.addEventListener("resize",function(){debug.log("Resize Event Fired");setTimeout(function(){Plugin.prototype.update_layout(true)},10)},false);window.addEventListener("orientationchange",function(){debug.log("Orientation Change Event Fired");
setTimeout(function(){Plugin.prototype.update_layout(true)},10)},false)})}})(jQuery,window,document);
